if [[ $# -lt 4 ]]; then
  echo -e "${ERROR} (${0##*/} - ${FUNCNAME[*]}): '${FUNCNAME[0]}' requires four arguments but got '$#'!" 1>&2
  exit 1
fi
local -r config_json="$1"
local -r json_key="$2"
declare -nr nrai_get_and_check_value_by_key_valid_values="$3"
declare -n nrstr_get_and_check_value_by_key_return="$4"


if (getNodeAsString "${config_json}" "${json_key}" nrstr_get_and_check_value_by_key_return) && true; then
  getNodeAsString "${config_json}" "${json_key}" nrstr_get_and_check_value_by_key_return
  echo "${nrstr_get_and_check_value_by_key_return}"
  if [[ -z "${nrstr_get_and_check_value_by_key_return}" ]]; then
    nrstr_get_and_check_value_by_key_return="${nrai_get_and_check_value_by_key_valid_values[0]}"
  else
    found_match=false
    for val in "${nrai_get_and_check_value_by_key_valid_values[@]}"; do
      if [[ "${val}" == "${nrstr_get_and_check_value_by_key_return}" ]]; then
        found_match=true
        break
      fi
    done
    if [[ "${found_match}" == false ]]; then
      echo -e "${ERROR} (${0##*/} - ${FUNCNAME[*]}): default value '${nrstr_get_and_check_value_by_key_return}' is not in list of valid values '${nrai_get_and_check_value_by_key_valid_values[*]}'." 1>&2
      exit 1
    fi
  fi
else
  nrstr_get_and_check_value_by_key_return="${nrai_get_and_check_value_by_key_valid_values[0]}"
fi
